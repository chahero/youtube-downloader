<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>관리자 대시보드 - Youtube Downloader</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        .admin-container {
            max-width: 1200px;
            margin: 2em auto;
            padding: 0 1em;
        }

        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2em;
            padding-bottom: 1em;
            border-bottom: 2px solid var(--border-color);
        }

        .admin-header h1 {
            margin: 0;
        }

        .admin-nav {
            margin-bottom: 2em;
        }

        .admin-nav a {
            display: inline-block;
            padding: 0.5em 1em;
            margin-right: 0.5em;
            background-color: var(--card-bg);
            color: var(--text-color);
            text-decoration: none;
            border-radius: 8px;
            transition: background-color 0.3s;
        }

        .admin-nav a:hover {
            background-color: #4a9eff;
        }

        .error-message {
            padding: 1em;
            background-color: rgba(255, 138, 138, 0.1);
            border: 1px solid #ff8a8a;
            color: #ff8a8a;
            border-radius: 8px;
            margin-bottom: 2em;
        }

        .section {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 2em;
            margin-bottom: 2em;
            border: 1px solid var(--border-color);
        }

        .section h2 {
            margin-top: 0;
            padding-bottom: 0.5em;
            border-bottom: 2px solid var(--border-color);
        }

        .user-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .user-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1em;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            margin-bottom: 0.5em;
            background-color: rgba(0, 0, 0, 0.2);
        }

        .user-info {
            flex-grow: 1;
        }

        .user-name {
            font-weight: bold;
            margin-bottom: 0.25em;
        }

        .user-date {
            font-size: 0.9em;
            color: #999;
        }

        .user-actions {
            display: flex;
            gap: 0.5em;
        }

        .btn {
            padding: 0.5em 1em;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            transition: opacity 0.3s;
        }

        .btn-approve {
            background-color: #8aff8a;
            color: #000;
        }

        .btn-approve:hover {
            opacity: 0.8;
        }

        .btn-reject {
            background-color: #ff8a8a;
            color: #fff;
        }

        .btn-reject:hover {
            opacity: 0.8;
        }

        .empty-message {
            text-align: center;
            color: #999;
            padding: 2em;
        }

        .success-message {
            padding: 1em;
            background-color: rgba(138, 255, 138, 0.1);
            border: 1px solid #8aff8a;
            color: #8aff8a;
            border-radius: 8px;
            margin-bottom: 1em;
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <div class="admin-header">
            <h1>관리자 대시보드</h1>
            <div>
                <a href="{{ url_for('index') }}" style="margin-right: 1em;">← 다운로더로 돌아가기</a>
                <a href="{{ url_for('logout') }}">로그아웃</a>
            </div>
        </div>

        {% if error %}
        <div class="error-message">{{ error }}</div>
        {% endif %}

        <div id="message-container"></div>

        <!-- 승인 대기 중인 사용자 -->
        <div class="section">
            <h2>승인 대기 중인 사용자</h2>
            {% if pending_users %}
            <ul class="user-list">
                {% for user in pending_users %}
                <li class="user-item">
                    <div class="user-info">
                        <div class="user-name">{{ user.username }}</div>
                        <div class="user-date">가입일: {{ user.created_at.strftime('%Y-%m-%d %H:%M') }}</div>
                    </div>
                    <div class="user-actions">
                        <button class="btn btn-approve" onclick="approveUser({{ user.id }}, '{{ user.username }}')">
                            ✓ 승인
                        </button>
                        <button class="btn btn-reject" onclick="rejectUser({{ user.id }}, '{{ user.username }}')">
                            ✗ 거절
                        </button>
                    </div>
                </li>
                {% endfor %}
            </ul>
            {% else %}
            <div class="empty-message">승인 대기 중인 사용자가 없습니다.</div>
            {% endif %}
        </div>

        <!-- 승인된 사용자 -->
        <div class="section">
            <h2>승인된 사용자</h2>
            {% if approved_users %}
            <ul class="user-list">
                {% for user in approved_users %}
                <li class="user-item">
                    <div class="user-info">
                        <div class="user-name">
                            {{ user.username }}
                            {% if user.is_admin %}
                            <span style="color: #4a9eff; margin-left: 0.5em;">[관리자]</span>
                            {% endif %}
                        </div>
                        <div class="user-date">가입일: {{ user.created_at.strftime('%Y-%m-%d %H:%M') }}</div>
                    </div>
                </li>
                {% endfor %}
            </ul>
            {% else %}
            <div class="empty-message">승인된 사용자가 없습니다.</div>
            {% endif %}
        </div>
    </div>

    <script>
        function showMessage(message, isSuccess = true) {
            const container = document.getElementById('message-container');
            const div = document.createElement('div');
            div.className = isSuccess ? 'success-message' : 'error-message';
            div.textContent = message;
            container.innerHTML = '';
            container.appendChild(div);

            // 3초 후 메시지 제거
            setTimeout(() => {
                div.remove();
            }, 3000);
        }

        function approveUser(userId, username) {
            if (!confirm(`${username} 사용자를 승인하시겠습니까?`)) {
                return;
            }

            fetch(`/api/admin/approve/${userId}`, { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showMessage(`${username} 사용자가 승인되었습니다.`, true);
                        setTimeout(() => location.reload(), 1500);
                    } else {
                        showMessage(data.error, false);
                    }
                })
                .catch(error => {
                    showMessage(`오류가 발생했습니다: ${error}`, false);
                });
        }

        function rejectUser(userId, username) {
            if (!confirm(`${username} 사용자를 거절하시겠습니까? 이 계정은 삭제됩니다.`)) {
                return;
            }

            fetch(`/api/admin/reject/${userId}`, { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showMessage(`${username} 사용자가 거절되었습니다.`, true);
                        setTimeout(() => location.reload(), 1500);
                    } else {
                        showMessage(data.error, false);
                    }
                })
                .catch(error => {
                    showMessage(`오류가 발생했습니다: ${error}`, false);
                });
        }
    </script>
</body>
</html>
